{% load static %}

<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-gray-900">
            {% if action == 'edit' %}تعديل العنوان{% else %}إضافة عنوان جديد{% endif %}
        </h3>
        <button 
            onclick="document.getElementById('address-form-container').innerHTML=''"
            class="text-gray-400 hover:text-gray-600 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    {% if errors %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-start">
            <svg class="w-5 h-5 text-red-600 mt-0.5 ms-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
            </svg>
            <ul class="text-sm text-red-700 list-disc list-inside me-3">
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <form 
        {% if action == 'edit' %}
        hx-post="{% url 'users:edit_address' address.id %}"
        {% else %}
        hx-post="{% url 'users:add_address' %}"
        {% endif %}
        hx-target="#address-list-container"
        hx-swap="innerHTML"
        class="space-y-4">
        {% csrf_token %}

        <!-- Label -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">تسمية العنوان *</label>
            <input 
                type="text" 
                name="label" 
                value="{% if address %}{{ address.label }}{% endif %}"
                required
                placeholder="مثال: المنزل، العمل، الشركة"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Full Name -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">الاسم الكامل *</label>
                <input 
                    type="text" 
                    name="full_name" 
                    value="{% if address %}{{ address.full_name }}{% endif %}"
                    required
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>

            <!-- Phone Number -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">رقم الهاتف *</label>
                <input 
                    type="tel" 
                    name="phone_number" 
                    value="{% if address %}{{ address.phone_number }}{% endif %}"
                    required
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>

        <!-- Street -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">الشارع والعنوان التفصيلي *</label>
            <input 
                type="text" 
                name="street" 
                value="{% if address %}{{ address.street }}{% endif %}"
                required
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Building Number -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">رقم المبنى</label>
                <input 
                    type="text" 
                    name="building_number" 
                    value="{% if address %}{{ address.building_number }}{% endif %}"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>

            <!-- Apartment Number -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">رقم الشقة</label>
                <input 
                    type="text" 
                    name="apartment_number" 
                    value="{% if address %}{{ address.apartment_number }}{% endif %}"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- City -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">المدينة *</label>
                <input 
                    type="text" 
                    name="city" 
                    value="{% if address %}{{ address.city }}{% endif %}"
                    required
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>

            <!-- State -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">المحافظة/الولاية</label>
                <input 
                    type="text" 
                    name="state" 
                    value="{% if address %}{{ address.state }}{% endif %}"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>

            <!-- Postal Code -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">الرمز البريدي</label>
                <input 
                    type="text" 
                    name="postal_code" 
                    value="{% if address %}{{ address.postal_code }}{% endif %}"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>

        <!-- Country -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">الدولة *</label>
            <input 
                type="text" 
                name="country" 
                value="{% if address %}{{ address.country }}{% else %}السعودية{% endif %}"
                required
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
        </div>

        <!-- Additional Info -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">معلومات إضافية</label>
            <textarea 
                name="additional_info" 
                rows="2"
                placeholder="إرشادات التوصيل أو علامات مميزة"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">{% if address %}{{ address.additional_info }}{% endif %}</textarea>
        </div>

        <!-- Is Default Checkbox -->
        <div class="flex items-center">
            <input 
                type="checkbox" 
                name="is_default" 
                id="is_default"
                {% if address.is_default %}checked{% endif %}
                class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
            <label for="is_default" class="me-2 text-sm font-medium text-gray-700">
                تعيين كعنوان افتراضي
            </label>
        </div>

        <!-- Buttons -->
        <div class="flex gap-3 pt-4">
            <button 
                type="submit"
                class="flex-1 bg-primary hover:bg-primary/90 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                {% if action == 'edit' %}حفظ التغييرات{% else %}إضافة العنوان{% endif %}
            </button>
            <button 
                type="button"
                onclick="document.getElementById('address-form-container').innerHTML=''"
                class="px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition-colors">
                إلغاء
            </button>
        </div>
    </form>
</div>